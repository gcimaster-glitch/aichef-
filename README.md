# Aメニュー（Aichefs.net）

**今日の献立、明日の笑顔**  
30日分の献立があなたの毎日を彩ります

---

## 🌐 本番環境URL

- **メインサイト**: https://aichefs.net
- **献立作成アプリ**: https://aichefs.net/app
- **管理画面**: https://aichefs.net/admin.html

**開発環境URL**:
- https://aichef-595.pages.dev
- https://aichef-595.pages.dev/app
- https://aichef-595.pages.dev/admin.html

---

## 📋 プロジェクト概要

Aメニューは、家族構成や好み、予算に合わせて自動的に30日分の献立を生成するWebアプリケーションです。AI技術を活用した対話型インターフェースで、誰でも簡単に献立計画を立てることができます。

### 主な特徴

- 📅 **30日分の献立自動生成**: 703品のレシピDBから最適な組み合わせを選択
- 👨‍👩‍👧‍👦 **家族構成対応**: 人数、年齢、好き嫌い、アレルギーに対応
- 💰 **予算管理**: 1人あたり300円〜1200円で設定可能
- ⏱️ **時短対応**: 調理時間15分〜60分で選択可能
- 🎭 **20種類の監修モード**: 栄養士監修、時短ママ、グルメパパなど
- 🤖 **AI対話機能**: 献立の理由説明、変更提案、代替レシピ
- 🖱️ **ドラッグ&ドロップ**: 献立の日付を自由に入れ替え
- 📜 **履歴機能**: 過去の献立を保存・再利用
- 🛒 **買い物リスト**: 週ごと・カテゴリ別に自動生成
- 📱 **レスポンシブ対応**: スマホ・タブレット・PCに最適化

---

## 🎯 主要機能

### ユーザー向け機能（16機能）

1. **献立生成システム**
   - 703品のレシピDB（主菜351、副菜231、汁物121）
   - 主菜・副菜・汁物の3品セット
   - 重複回避（7日間間隔厳守）
   - カレー系も7日間隔厳守（月3〜4回まで）
   - カレーの場合は汁物をサラダに自動変更

2. **AI対話機能**
   - 献立の理由説明
   - 変更提案（代替レシピ3件提示）
   - ワンクリックで差し替え

3. **カレンダー機能**
   - 月表示/リスト表示切替
   - ドラッグ&ドロップで献立移動
   - Googleカレンダー連携（ICSエクスポート）
   - 印刷対応（A4最適化）

4. **買い物リスト**
   - 週ごとの食材リスト
   - カテゴリ別表示（野菜・肉・魚など）
   - 同じ食材を自動合算
   - チェックリスト機能

5. **レシピ詳細**
   - 材料・分量（カテゴリ別）
   - 詳細な手順
   - 調理のコツ
   - 基本情報（時間・難易度・予算）

6. **お気に入り・共有**
   - お気に入りレシピ登録
   - SNS共有（X/Facebook/LINE）
   - URLコピー

7. **献立履歴**
   - 過去の献立を保存
   - 履歴から再読み込み
   - アーカイブ機能

8. **質問フロー**
   - ステップ式質問
   - 前の質問に戻る機能
   - 進捗バー表示

### 管理画面機能（9機能）

1. **ダッシュボード**
   - 総合統計（ユーザー数・献立数・アクセス数）
   - グラフ表示（ユーザー推移・家族構成）
   - 最近のアクティビティ

2. **ユーザー管理**
   - ユーザー一覧・詳細
   - 検索・フィルター
   - CSVエクスポート

3. **メール配信**
   - キャンペーン作成・管理
   - 配信スケジュール設定
   - 開封率・クリック率追跡
   - テンプレート管理
   - 署名管理

4. **アクセス解析**
   - ページビュー推移
   - 人気ページランキング
   - アクセスログ

5. **広告管理**
   - 広告作成・編集
   - 効果測定（インプレッション・クリック）
   - 配信スケジュール

---

## 🛠️ 技術スタック

### フロントエンド
- **HTML5** + **Tailwind CSS**: レスポンシブUI
- **Vanilla JavaScript**: 軽量で高速
- **Chart.js**: グラフ描画
- **Axios**: API通信
- **Font Awesome**: アイコン

### バックエンド
- **Hono Framework**: 軽量・高速なWebフレームワーク
- **Cloudflare Workers**: エッジコンピューティング
- **Cloudflare Pages**: 静的サイトホスティング
- **TypeScript**: 型安全な開発

### データベース
- **Cloudflare D1**: SQLiteベースの分散データベース
- **テーブル構成**:
  - households（家族プロファイル）
  - meal_plans（献立プラン）
  - recipes（レシピ）
  - ingredients（食材マスター）
  - admin_users（管理者）
  - email_campaigns（メールキャンペーン）
  - access_logs（アクセスログ）

### デプロイ
- **Cloudflare Pages**: 自動デプロイ
- **Git**: バージョン管理
- **Wrangler CLI**: デプロイツール

---

## 🚀 デプロイ手順

### 1. 必要な環境変数

なし（Cloudflare D1を使用）

### 2. ローカル開発

```bash
# 依存パッケージのインストール
npm install

# ローカルDBのリセット（初回のみ）
npm run db:reset

# 開発サーバーの起動
npm run build
pm2 start ecosystem.config.cjs

# ブラウザで確認
curl http://localhost:3000
```

### 3. 本番デプロイ

```bash
# ビルド
npm run build

# Cloudflare Pagesにデプロイ
npx wrangler pages deploy dist --project-name aichef --branch main

# データベースマイグレーション（本番）
npx wrangler d1 migrations apply aichef-production --remote
```

### 4. カスタムドメイン設定

1. Cloudflare Dashboard にログイン: https://dash.cloudflare.com/
2. Workers & Pages > aichef > Custom domains
3. 「Set up a custom domain」をクリック
4. ドメイン「aichefs.net」を入力
5. DNSレコードが自動追加される
6. SSL証明書が自動発行される（数分）

---

## 📂 プロジェクト構造

```
webapp/
├── src/
│   └── index.tsx              # メインアプリケーション
├── public/
│   ├── admin.html             # 管理画面
│   └── landing.html           # ランディングページ
├── migrations/                # DBマイグレーション
│   ├── 0001_initial_schema.sql
│   ├── ...
│   └── 0017_admin_system.sql
├── dist/                      # ビルド出力
│   ├── _worker.js
│   └── _routes.json
├── wrangler.jsonc             # Cloudflare設定
├── package.json               # 依存関係
├── vite.config.ts             # Viteビルド設定
└── README.md                  # このファイル
```

---

## 🔐 管理画面

### アクセス方法

**URL**: https://aichefs.net/admin.html

**デモアカウント**:
- メールアドレス: `admin@aichef.com`
- パスワード: `admin123`

### 主な機能

- **ダッシュボード**: 統計・グラフ・アクティビティ
- **ユーザー管理**: 一覧・詳細・削除
- **メール配信**: キャンペーン作成・配信・効果測定
- **アクセス解析**: ページビュー・人気ページ
- **広告管理**: 広告作成・効果測定

---

## 📊 データベーススキーマ

### 主要テーブル

- **households**: 家族プロファイル
- **meal_plans**: 献立プラン
- **meal_plan_days**: 日別献立
- **recipes**: レシピマスター（703品）
- **ingredients**: 食材マスター
- **recipe_ingredients**: レシピ材料
- **plan_history**: 献立履歴
- **admin_users**: 管理者
- **email_campaigns**: メールキャンペーン
- **access_logs**: アクセスログ

---

## 🎨 20種類の監修モード

1. **一般（バランス重視）**: 全レシピからバランス良く選択
2. **栄養士監修**: 栄養バランス重視
3. **イケイケママ監修**: おしゃれ料理（人気度高め）
4. **家族ダイエット**: 低カロリー・時短
5. **高カロリー好きパパ監修**: ボリューム満点
6. **時短ママ監修**: 15分以内の簡単料理
7. **節約主婦監修**: コスパ重視
8. **グルメパパ監修**: バラエティ豊富
9. **和食中心**: 和食レシピ優先
10. **洋食中心**: 洋食レシピ優先
11. **中華好き**: 中華料理中心
12. **エスニック好き**: エスニック料理
13. **子供大好きメニュー**: 子供に人気の定番
14. **アスリート家族**: 高タンパク質
15. **ベジタリアン寄り**: 野菜中心
16. **魚好き家族**: 魚料理中心
17. **肉好き家族**: 肉料理中心
18. **シニア向け**: やわらかめ
19. **作り置き中心**: 作り置き可能
20. **ワンプレート**: ワンプレート料理

---

## 📝 開発メモ

### npm scripts

```bash
# 開発
npm run dev              # Vite開発サーバー
npm run dev:sandbox      # Wrangler開発サーバー（Sandbox用）
npm run build            # 本番ビルド

# データベース
npm run db:migrate:local # ローカルDB マイグレーション
npm run db:migrate:prod  # 本番DB マイグレーション
npm run db:seed          # テストデータ投入
npm run db:reset         # DBリセット＆再構築

# デプロイ
npm run deploy           # Cloudflare Pagesにデプロイ
npm run deploy:prod      # 本番環境にデプロイ

# Git
npm run git:init         # Git初期化
npm run git:commit       # コミット
npm run git:status       # ステータス確認
```

### 環境変数

**開発環境**:
- `.dev.vars`ファイルに記載（Gitにコミットしない）

**本番環境**:
- Cloudflare Dashboard > Settings > Environment variables

---

## 🐛 既知の問題

### 修正済み（2026-01-05）

1. ✅ **レシピ詳細表示**: `recipe_substitutes` テーブルの参照エラー → `substitutes_json` カラムを使用するように修正
2. ✅ **グローバル関数公開**: `onclick` ハンドラーから呼び出される全関数を `window` オブジェクトに公開
3. ✅ **本番DBマイグレーション**: `plan_history` テーブルが欠落 → 手動で適用完了
4. ✅ **献立生成エラー**: データベーステーブル不足 → 全マイグレーション適用完了

### 動作確認済み機能（2026-01-05）

- ✅ 献立生成（30日分）
- ✅ レシピ詳細表示
- ✅ AI対話機能（なぜこの献立？）
- ✅ 献立変更提案
- ✅ レシピ差し替え
- ✅ 買い物リスト生成
- ✅ お気に入り登録
- ✅ SNS共有
- ✅ Googleカレンダー連携
- ✅ 印刷機能

---

## 📜 ライセンス

Copyright © 2026 Aメニュー運営チーム  
All rights reserved.

---

## 📧 お問い合わせ

- **サポート**: support@aichef.com
- **公式サイト**: https://aichefs.net

---

## 🎉 バージョン履歴

### v1.0.0 (2026-01-05)
- ✅ 本番環境リリース（aichefs.net）
- ✅ 全16種類のユーザー機能実装
- ✅ 管理画面（9機能）実装
- ✅ データベース設計完了
- ✅ ドラッグ&ドロップ献立移動
- ✅ 献立履歴・再利用機能
- ✅ 買い物リスト機能
- ✅ レシピ詳細表示
- ✅ お気に入り・SNS共有
- ✅ 質問フローの改善

---

**Made with ❤️ by Aメニュー開発チーム**
